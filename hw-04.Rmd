---
title: "Домашнее задание 04 - Какую специальность выбрать?"
author: "Shchechkin Ilya"
date: "11.12.21"
output: github_document
---

Первым шагом в процессе превращения информации в знания является обобщение и описание необработанной информации - данных.
В этом задании мы исследуем данные по специальностям и доходам в колледжах, в частности, эти данные используются в статье на сайте FiveThirtyEight ["The Economic Guide To Picking A College Major"](https://fivethirtyeight.com/features/the-economic-guide-to-picking-a-college-major/).

Первоначально эти данные взяты из исследования American Community Survey (ACS) за 2010-2012 годы. Хотя это выходит за рамки этого задания, если вам интересно, как необработанные данные из ACS были очищены и подготовлены, см. [скрипт](https://github.com/fivethirtyeight/data/blob/master/college-majors/college-majors-rscript.R), который использовали авторы FiveThirtyEight.

Следует также отметить, что при выборе специальности необходимо учитывать множество факторов. Потенциальный заработок и перспективы трудоустройства - это два из них, и они важны, но не раскрывают всей картины.
Помните об этом при анализе данных.

## Load packages and data

Мы будем использовать пакет **tidyverse** для большей части обработки и визуализации данных, пакет **scales** для лучшего форматирования меток на графиках, а данные содержатся в пакете **fivethirtyeight**. Убедитесь, что эти пакеты установлены на Вашем компьютере.

```{r load-packages, message = FALSE}
library(tidyverse)
library(scales)
library(fivethirtyeight)
```

## Данные

Данные можно найти в пакете **fivethirtyeight**, набора данных называется `college_recent_grads`.
Поскольку набор данных распространяется вместе с пакетом, его не нужно загружать его отдельно: он становится  доступен, когда загружается пакет.
Вы можете узнать больше о наборе данных, просмотрев его документацию, к которой вы можете получить доступ, выполнив выражение `?college_recent_grads` в консоли. Вы также можете найти эту информацию [здесь](https://fivethirtyeight-r.netlify.app/reference/college_recent_grads.html).

Вы также можете взглянуть на свой фрейм данных и просмотреть его размеры с помощью функции `glimpse`.

```{r glimpse}
glimpse(college_recent_grads)
```

Фрейм `college_recent_grads` - кладезь информации.
Давайте подумаем о некоторых вопросах, на которые мы, возможно, захотим ответить с помощью этих данных:

- В какой отрасли самый низкий уровень безработицы?
- На какой специальности больше всего женщин?
- Как распределен медианный доход по основным категориям специальностей?
- Женщины склонны выбирать специальности с более низким или более высоким заработком?

Мы попробуем ответить на эти вопросы.

## В какой отрасли самый низкий уровень безработицы?

Чтобы ответить на этот вопрос, нам нужно просто отсортировать данные.
Для этого мы используем функцию `arrange` и отсортируем данные по переменной `unemployment_rate`.
По умолчанию `arrange` сортирует в порядке возрастания, что нам и требуется - нас интересует специальность с *самым низким* уровнем безработицы.

```{r lowest-unemp}
college_recent_grads %>%
  arrange(unemployment_rate)
```

Это дает нам то, что мы хотели, но не в идеальной форме.
Во-первых, название специальности почти не помещается на странице.
Во-вторых, некоторые переменные не особо полезны (например, `major_code`, `major_category`), а те, которые мы хотим видеть в первую очередь, запртаны очень глубоко (например, `unemployment_rate`).

Мы можем использовать функцию `select`, чтобы выбрать, какие переменные отображать и в каком порядке:

```{r lowest-unemp-select}
college_recent_grads %>%
  arrange(unemployment_rate) %>%
  select(rank, major, unemployment_rate)
```

Хорошо, так выглядит лучше, но действительно ли нам нужно отображать все эти десятичные знаки в переменной безработицы?
Не совсем!

Мы можем использовать функцию `percent()`, чтобы немного сократить отображение.

```{r}
college_recent_grads %>%
  arrange(unemployment_rate) %>%
  select(rank, major, unemployment_rate) %>%
  mutate(unemployment_rate = percent(unemployment_rate))
```

## На какой специальности больше всего женщин?

Для ответа на этот вопрос нужно расположить данные в порядке убывания.
Например, если бы в предыдущем вопросе нас интересовала специализация с самым высоким уровнем безработицы, мы бы использовали следующий код (функция `desc` определяет обратный порядок сортировки):

```{r}
college_recent_grads %>%
  arrange(desc(unemployment_rate)) %>%
  select(rank, major, unemployment_rate)
```

### Упражнение 1

Расположите данные в порядке убывания доли женщин в каждой специальности и отобразите только следующие переменные: специальность, общее количество людей и доля женщин. Отобразите только 3 верхних специальности, добавив в конце конвейера `top_n(3)`.

---
```{r}
college_recent_grads %>%
  arrange(desc(sharewomen)) %>%
  select(major,men,sharewomen) %>%
  top_n(3)
```

---

## Как распределен медианный доход по основным категориям специальностей?

Процентиль - это мера, используемая в статистике, указывающая значение, ниже которого наодится определенный процент наблюдений в выборке. Например, 20-й процентиль - это значение, меньше которого 20% наблюдений. 

Во фрейме представлены три типа доходов: `p25th`, `median` и `p75th`.
Они соответствуют 25-му, 50-му и 75-му процентилям распределения доходов людей, получивших данную специальность.

### Упражнение 2

Вопрос, на который мы хотим ответить: «Как распределен медианный доход по основным категориям специальностей?».
Чтобы ответить на этот вопрос, нам нужно сделать несколько действий. Во-первых, нам нужно сгруппировать данные по `major_category`.
Затем нам нужен способ обобщить и представить распределение медианного дохода внутри этих групп.
Это решение будет зависеть от формы этих распределений. Итак, сначала нам нужно визуализировать данные.

Для этого мы используем функцию `ggplot()`.
Первый аргумент - это фрейм, а следующий аргумент задает соответствие переменных эстетикам графика.

Начнем с простого и посмотрим на распределение всех медианных доходов без учета основных категорий. Постройте гистограмму переменной `median`.
Хорошая практика - попробовать несколько значений ширины интервала, прежде чем сделать окончательный выбор.
Вы можете спросить себя: «Какова будет осмысленная разница в медианных доходах?» \$1 явно слишком мало, \$10000 может быть слишком много.
Выберите оптимальную ширину интервала. Попробуйте ширину \$1000 и \$5000 и выберите один вариант. Объясните, почему вы сделали свой выбор. Обратите внимание, что ширина интервала является аргументом функции `geom_histogram`. Например, чтобы указать ширину интервала \$1000, нужно использовать `geom_histogram(binwidth = 1000)`.

Охарактеризуйте форму распределения. Какая мера положения лучше всего описывает типичное значение медианного дохода?

---
```{r}
library(ggplot2)
ggplot(college_recent_grads, aes(x = median)) +
  geom_histogram(binwidth = 5000) 
```

5000 дают меньше шума.
Гистограмма скошена вправо. Среднее.

---

### Упражнение 3

Постройте гистограммы распределения медианного дохода для каждой из категорий специальностей (переменная `major_category`). Используйте параметр binwidth, который вы выбрали в предыдущем упражнении.

```{r}
library(ggplot2)
ggplot(college_recent_grads, aes(x = median)) +
  geom_histogram(binwidth = 5000) +
  facet_wrap(~major_category)
```

---

### Упражнение 4

Какая категория специальностей имеет самый высокий типичный медианный доход? Рассчитайте описательные статистики для категорий специальностей, упорядочите категории по убыванию типичного дохода.

```{r}
college_recent_grads %>%
  group_by(major_category) %>%
  summarise(mean_med = mean(median), var_med = var(median), sd_med = sd(median), min_med = min(median), max_med = max(median))%>%
  arrange(desc(mean_med))
```

### Упражнение 5

Какая категория специальностей наименее популярна в этой выборке? Чтобы ответить на этот вопрос, используйте  функцию `count`, которая сначала группирует данные, а затем подсчитывает количество наблюдений в каждой категории. Упорядочите результаты так, чтобы категория с наименьшей частотой была наверху.

...
```{r}
college_recent_grads %>%
  count(major_category) %>%
  arrange(n)
```

### Упражнение 6

Создайте во фрейме новую переменную `major_type`, которая принимает значение `stem` для естественно-научных категорий (Biology & Life Science, Computers & Mathematics, Engineering, Physical Sciences) и значение `non-stem` для все остальных.

```{r}
i = 1
for(i in 1:173) {
  if(college_recent_grads$major_category[i] == 'Biology & Life Science'){
    college_recent_grads$major_type[i] = 'stem'
  }
  else if (college_recent_grads$major_category[i] == 'Computers & Mathematics'){
    college_recent_grads$major_type[i] = 'stem'
  }
  else if (college_recent_grads$major_category[i] == 'Engineering'){
    college_recent_grads$major_type[i] = 'stem'
  }
  else if (college_recent_grads$major_category[i] == 'Physical Sciences'){
    college_recent_grads$major_type[i] = 'stem'
  }
  
  else if (college_recent_grads$major_category[i] != 'Biology & Life Science'){
    college_recent_grads$major_type[i] = 'non-stem'
  }
  else if (college_recent_grads$major_category[i] != 'Computers & Mathematics'){
    college_recent_grads$major_type[i] = 'non-stem'
  }
  else if (college_recent_grads$major_category[i] != 'Engineering'){
    college_recent_grads$major_type[i] = 'non-stem'
  }
  else if (college_recent_grads$major_category[i] != 'Physical Sciences'){
    college_recent_grads$major_type[i] = 'non-stem'
  }
}

college_recent_grads %>%
  select(major_category,major_type)
```

```

```

### Упражнение 7

У каких естественно-научных специальностей медианная заработная плата равна или меньше медианы для заработка всех специальностей? Результат должен отображать только название специальности и медианный доход, 25-й процентиль и 75-й процентиль заработка для этой специальности, он также должен быть отсортирован по убыванию медианного дохода.

...
```{r}
mean_zp = mean(college_recent_grads$median)
college_recent_grads %>%
  filter(
    major_type == 'stem'
  ) %>%
  group_by(major_category) %>%
  summarise(mean_med = mean(median), quan_25_med = quantile(median, probs = 0.25), quan_75_med = quantile(median, probs = 0.75))%>%
  filter(
    mean_med <= mean_zp
  ) %>%


  arrange(desc(mean_med))
```

### Упражнение 8

Создайте диаграмму зависимости медианного дохода от доли женщин в этой специальности, окрашенной в зависимости от того, является специальность естественно-научной или нет. Опишите связь между этими тремя переменными.

...
```{r}
library(ggplot2)
ggplot(college_recent_grads, aes(x = median, y = sharewomen,
                                 colour = major_type))+
  geom_point()+
  scale_colour_viridis_d()+
  labs(
    x = "Медианная зарплата",
    y = "Доля женщин",
    title = "Отношение медианной зарплаты к доле женщин в коллективе", 
    colour = "Специальность",
    )

```
Для естественно-научных направлений характерно меньшее кол-во женшин и большая заработная плата.